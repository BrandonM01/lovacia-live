<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lovacia Bot</title>
  <link rel="stylesheet" href="/static/app.css">
</head>
<body>
  <h1>Lovacia Bot</h1>

  <section>
    <h2>Process Image</h2>
    <form id="image-form" enctype="multipart/form-data">
      <input type="file" name="file" accept="image/*" required>
      <label>Flip horizontally: <input type="checkbox" name="flip"></label>
      <label>Contrast min (%): <input type="number" name="contrast_min" value="-5" step="0.1"></label>
      <label>Contrast max (%): <input type="number" name="contrast_max" value="5" step="0.1"></label>
      <button type="submit">Upload &amp; Process</button>
    </form>
    <div id="image-result"></div>
  </section>

  <hr>

  <section>
    <h2>Process Video</h2>
    <form id="video-form" enctype="multipart/form-data">
      <input type="file" name="file" accept="video/*" required>
      <label>Trim start (s): <input type="number" name="trim_start" value="0" step="0.1"></label>
      <label>Trim end (s): <input type="number" name="trim_end" step="0.1"></label>
      <label>Flip horizontally: <input type="checkbox" name="flip"></label>
      <button type="submit">Upload &amp; Process</button>
    </form>
    <div id="video-result"></div>
  </section>

  <script>
    // helper to build query string
    function buildQS(fields, form) {
      return fields
        .map(f => {
          const el = form[f];
          if (!el) return "";
          if (el.type === "checkbox") return el.checked ? `${f}=true` : "";
          if (el.value === "") return "";
          return `${f}=${encodeURIComponent(el.value)}`;
        })
        .filter(s => s)
        .join("&");
    }

    document.getElementById("image-form").onsubmit = async e => {
      e.preventDefault();
      const f = e.target;
      const data = new FormData(f);
      const qs = buildQS(["flip","contrast_min","contrast_max"], f);
      const res = await fetch(`/process-image/?${qs}`, {method:"POST", body:data});
      if (!res.ok) return alert("Error " + res.status);
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      document.getElementById("image-result").innerHTML = `<img src="${url}" alt="Processed Image">`;
    };

    document.getElementById("video-form").onsubmit = async e => {
      e.preventDefault();
      const f = e.target;
      const data = new FormData(f);
      const qs = buildQS(["trim_start","trim_end","flip"], f);
      const res = await fetch(`/process-video/?${qs}`, {method:"POST", body:data});
      if (!res.ok) return alert("Error " + res.status);
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      document.getElementById("video-result").innerHTML = `<video src="${url}" controls></video>`;
    };
  </script>
</body>
</html>
