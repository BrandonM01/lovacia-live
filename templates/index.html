<!DOCTYPE html>
<html>
<head>
  <title>Lovacia Bot</title>
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
  <h1>Upload Your Images</h1>
  <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
    <input type="file" name="files" multiple>
    &nbsp;&nbsp;
    <label>
      Variations:
      <input type="number" name="count" value="1" min="1" max="20" style="width:4em">
    </label>
    &nbsp;&nbsp;
    <button type="submit">Upload</button>
  </form>

  <div id="preview">
    <h2>Processed Images</h2>
    <div id="imagePreview"></div>
  </div>

  <script>
  document.getElementById("uploadForm").onsubmit = async (e) => {
    e.preventDefault();
    const form = e.target;
    const data = new FormData(form);

    // show a quick “loading…”
    const preview = document.getElementById("imagePreview");
    preview.innerHTML = "<em>Processing…</em>";

    const res = await fetch("/upload", {
      method: "POST",
      body: data
    });
    const payload = await res.json();

    // clear & render each processed image + link
    preview.innerHTML = "";
    payload.processed.forEach(item => {
      const img = document.createElement("img");
      img.src = item.image;
      img.style.maxWidth = "200px";
      img.style.margin = "0.5em";
      preview.appendChild(img);

      const a = document.createElement("a");
      a.href = item.download_link;
      a.innerText = "Download";
      a.target = "_blank";
      preview.appendChild(a);
      preview.appendChild(document.createElement("br"));
    });
  };
  </script>
</body>
</html>
